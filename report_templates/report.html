<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Полный отчет - ${pcb_name}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/styles/style.css">
    <script type="text/javascript">
        var flag = false;

        /**
         * Function changes size of board image and position of area pins on it.
         */
        function change_size() {
            if (!flag) {
                flag = true;
                const WIDTH = 800;
                let board_img = document.getElementById("board");
                let natural_width = board_img.naturalWidth;
                board_img.width = WIDTH;
                let pin_areas = document.getElementsByTagName("area");
                for (let i = 0; i < pin_areas.length; i++) {
                    let pin = pin_areas[i];
                    let coords = pin.getAttribute("coords").split(",");
                    let x = coords[0] * WIDTH / natural_width;
                    let y = coords[1] * WIDTH / natural_width;
                    pin.setAttribute("coords", x + "," + y + "," + coords[2]);
                }
            }
        }
    </script>
</head>

<body onload="change_size()">
    <div id="wrapper">
        <h1>Полный отчет</h1>
        <h2>${pcb_name}</h2>
        <table id="general_info" cellspacing="0" cellpadding="0">
            <thead>
                <tr>
                    <th colspan="2">
                        <h2>Общая информация</h2>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="vertical-align: top;">
                        <span>Всего компонентов: ${elements_number}</span><br>
                        <span>Всего точек тестирования: ${pins_number}</span><br>
                        <span><a href="full_img.html" target="_blank">Исследовать по изображению</span><br>
                    </td>
                </tr>
                <tr>
                    <th colspan="2">
                        % if len(pins) > 0:
                        <h2>Карта точек тестирования</h2>
                        % else:
                        <h2>Точек тестирования нет</h2>
                        % endif
                        <img id="board" src="static/img/board.png" usemap="#map">
                        <p><map name="map">
                            % for name, element_index, pin_index, x, y in pins:
                            <area shape="circle" coords="${x},${y},10" href="#point${x}${y}" alt="">
                            % endfor
                            </map>
                        </p>
                    </th>
                </tr>
            </tbody>
        </table>

        % if len(pins) > 0:
        <table id="report" cellspacing="0" cellpadding="0">
            <thead>
                <tr>
                    <th class="element-name"><span>Имя</span></th>
                    <th class="element-image"><span>Компонент</span></th>
                    <th class="element-plot"><span>ВАХ</span></th>
                </tr>
            </thead>
            <tbody>
                % for name, element_index, pin_index, x, y in pins:
                <tr>
                    <td class="lalign"><span>${name} (pin ${pin_index + 1})</span><br>
                        <a class="anchor" id="top" name="point${x}${y}"></a>
                        % if mm_per_px:
                        <span>X = ${"%.2f".format(x * mm_per_px) } мм, Y = ${"%.2f".format(y * mm_per_px)} мм</span>
                        % else:
                        <span>X = ${x} пк, Y = ${y} пк</span>
                        % endif
                    </td>
                    <td>
                        <a class="img_pin">
                            <img src="static/img/${'%s_%s_%s_pin.png'%(name, element_index, pin_index)}" height="${pin_img_size}" />
                            <span style="position:absolute; left:-500px;">
                                <img src="static/img/board.png" width="500px" style="position:relative">
                                <div class="pin" style="position:absolute; top:${y * (500 / board_img_width)}px; left:${x * (500 / board_img_width)}px;">
                                </div>
                                </img>
                            </span>
                        </a>
                    </td>
                    <td>
                        <img src="static/img/${'%s_%s_%s_iv.png'%(name, element_index, pin_index)}" height="${pin_img_size}">
                    </td>
                </tr>
                % endfor
            </tbody>
        </table>
        % endif
    </div>
</body>

</html>