<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="static/styles/style_for_full_img.css">
	<title>Изображение</title>
    <script>
		const PIN_WIDTH = 30;
		var mouse_x, mouse_y;
		document.addEventListener("mousemove", (event) => {
			mouse_x = event.clientX;
			mouse_y = event.clientY;
		});
		
        /**
         * Function changes position of image of IV-curve for pin.
         * @param pin_iv_img: image of IV-curve for pin.
         */
        function change_position(pin_iv_img) {
            pin_iv_img.style.top = "60%";
        }
		
		/**
		 * Function checks if mouse is inside image of IV-curve.
		 * @param object: image of IV-curve.
		 * @return: true if mouse is inside image of IV-curve.
		 */
		function check_point_inside(object) {
			const PERCENT = 0.2;
			let body = document.getElementsByTagName("body")[0];
			let body_width = body.getBoundingClientRect().width;
			let img_width = PERCENT * body_width;
			let img_height = object.naturalHeight * img_width / object.naturalWidth;
			if (0 <= mouse_x && mouse_x <= img_width && 0 <= mouse_y && mouse_y <= img_height)
				return true;
			return false;
		}

        /**
         * Function hides or shows image of IV-curve for pin.
         * @param pin: area on big image of board that represents pin;
         * @param show: if false image is hidden.
         */
        function hide_or_show_img(pin, show) {
			let hovered_pin = document.getElementById("pin");
			let coords = pin.getAttribute("coords");
			if (pin != hovered_pin && show)
				hovered_pin.setAttribute("coords", coords);
			else if (!show)
				hovered_pin.setAttribute("coords", "0,0,15");
            let pin_iv_img = document.getElementById("img" + coords);
			let board_x = document.getElementById("board_img").getBoundingClientRect().x;
			if (board_x < 0)
				board_x = 0;
            if (show) {
				if (check_point_inside(pin_iv_img))
					change_position(pin_iv_img);
                pin_iv_img.style.display = "block";
				let coords_array = coords.split(",");
				hovered_pin.style.left = parseFloat(coords_array[0]) + board_x - PIN_WIDTH / 2 + "px";
				hovered_pin.style.top = parseFloat(coords_array[1]) - PIN_WIDTH / 2 + "px";
				hovered_pin.style.visibility = "visible";
			}
            else {
                pin_iv_img.style.display = "none";
                pin_iv_img.style.top = "0px";
				hovered_pin.style.left = "0px";
				hovered_pin.style.top = "0px";
				hovered_pin.style.visibility = "hidden";
            }
        }

        window.onresize = function() {
            let imgs = document.getElementsByTagName("img");
            for (let i = 1; i < imgs.length; i++) {
                let pin_iv_img = imgs[i];
                pin_iv_img.style.width = "20%";
            }
        }
    </script>
</head>

<body>
    <center>
		<img id="board_img" src="static/img/board.png" usemap="#map">
			<div id="pin" onmouseover="hide_or_show_img(this, true);" onmouseout="hide_or_show_img(this, false);" coords="0,0,15">
			</div>
		</img>
	</center>
    <p>
		<map name="map">
			% for name, element_index, pin_index, x, y, _, _, _, _ in pins:
			<area onmouseover="hide_or_show_img(this, true);" shape="circle" coords="${x},${y},10" href="#point${x}${y}" alt="">
			% endfor
		</map>
	</p>
    % for name, element_index, pin_index, x, y, _, _, _, _ in pins:
    <img id="img${x},${y},10" onmouseover="change_position(this);" style="position: fixed; top: 0px; left: 0px; width: 20%; display: none;"
		src="static/img/${'%s_%s_%s_iv.png'%(name, element_index, pin_index)}" />
	% endfor
</body>

</html>
