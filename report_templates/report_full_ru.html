<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Полный отчёт - ${pcb_name}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="static/style.css">
	<script type="text/javascript">
					function byId(e){return document.getElementById(e);}
						var flag = false;
					function coordresize()
					{
						if(!flag)
						{
						flag = true; 
						var myImg = byId('board');
						var realWidth = myImg.naturalWidth;
						var realHeight = myImg.naturalHeight;
						var newheight = realHeight * 800 / realWidth;
						byId('board').width = "800";
						byId('board').height = newheight;
						var elements = document.getElementsByTagName('area');
						  for (var i = 0; i < elements.length; i++) 
						  {
								var element = elements[i];			
								var coordStr = element.getAttribute('coords');
								var mCoords = coordStr.split(',');
								var top, left;
								left = mCoords[0];
								top = mCoords[1];
								left = (left * 800 / realWidth);
								top = top * 800 /realWidth;
								mCoords[0] = left;
								mCoords[1] = top;
								coordStr = mCoords[0] + ',' + mCoords[1] + ',' + mCoords[2];
								element.setAttribute('coords', coordStr);
						}
					   }
					}
				</script>
</head>
<body onload = 'coordresize()'>
 <div id="wrapper">
  <h1>Полный отчёт</h1>
  <h2>${pcb_name}</h2>
    <table id="general_info" cellspacing="0" cellpadding="0">
        <thead>
          <tr>
            <th colspan="2"><h2>Общая информация</h2></th>
          </tr>
        </thead>
        <tbody>
        <tr>
            % if is_sample:
                <td>
            % else:
                <td style="vertical-align: top;">
            % endif
                <span>Диагностическая система: EyePoint P10</span><br>
                <span>Версия: ${gen_info["version"]}</span><br>
                <span>Дата: ${gen_info["date"]}</span><br>
                <span>Рабочая станция: ${gen_info["computer"]}</span><br>
                <span>Операционная система: ${gen_info["operating_system"]}</span><br>
                <span>Длительность тестирования: ${gen_info["test_time"]}</span><br>
                <span>Всего компонентов: ${gen_info["els_fail"].split("/")[1]}</span><br>
                <span>Всего точек тестирования: ${gen_info["test_points_fail"].split("/")[1]}</span><br>
                <span>HTML: v4.01 </span><br>
                <span><a href="full_img_ru.html" target="_blank">Исследовать по изображению</span><br>
            </td>
            % if not is_sample:
                <td>
                    <img src="static/hist.png" width="400px">
                </td>
            % endif
        </tr>
        <tr>
            <th colspan="2">
				% if len(tp)>0:
                    % if is_sample:
                        <h2>Карта точек тестирования, оси в мм:</h2>
                    % else:
                        <h2>Карта неисправностей, оси в мм:</h2>
                    % endif
			    % else:
					<h2>Неисправных компонентов нет.</h2>
				% endif    
				<img id = 'board' src="static/board.png" usemap="#map">
					<p><map name="map">
					% for name, manual_name, el_i, p_i, r, c, score in tp:	
					<area shape="circle" coords="${c},${r},6" href="#point${c}${r}" alt="">
					%endfor
					</map></p>
            </th>
        </tr>
        </tbody>
    </table>
  
  % if len(tp)>0:
  <table id="report" cellspacing="0" cellpadding="0">
    <thead>
      <tr>
        <th class="element-name"><span>Имя</span></th>
        <th class="element-image"><span>Компонент</span></th>
        % if is_sample:
          <th class="element-plot"><span>ВАХ</span></th>
        % else:
          <th class="element-plot"><span>ВАХ (синяя кривая - эталон)</span></th>
        % endif
      </tr>
    </thead>
    <tbody>
	% for name, manual_name, el_i, p_i, r, c, score in tp:
		<tr>
		% if name.split("_")[0] == "UserElement":
            <td class="lalign"><span>${manual_name} (pin ${p_i + 1})</span> <br>
        % else:
		    <td class="lalign"><span>${name} (pin ${p_i + 1})</span> <br>
        %endif
        % if not is_sample:
		    <span>Степень различия = ${'%.4f' % score}</span> <br>
        % endif
        <a class="anchor" id="top" name="point${c}${r}"></a>
		<span>X = ${'%.2f' % (c*pix_per_mm) } мм, Y = ${'%.2f' % (r*pix_per_mm)} мм</span>
		</td>
		<td>
			<a class="img_pin">
                <img src="static/${'%s_%s_%s.png'%(name, el_i, p_i)}" height="${patch_size}"/>
                <span style="position:absolute; left:-500px;">
                    <img src="static/board.png" width=500px" height="${gen_info["height"]*(500/gen_info["width"])}px" style="position:relative">
                        <div class="pin" style="position:absolute; top:${r*(500/gen_info["width"])}px;
                         left:${c*(500/gen_info["width"])-3}px;" ></div>

                    </img>
                </span>
            </a>
		</td>
		<td>
			<img src="static/${'plot_%s_%s_%s.png'%(name, el_i, p_i)}" height="${patch_size}">
		</td>
		</tr>
	% endfor
    </tbody>
  </table>
  <!-- % else: -->
  <!--  <h2>No faulty elements</h2> -->
  % endif
 </div> 
</body>
</html>
